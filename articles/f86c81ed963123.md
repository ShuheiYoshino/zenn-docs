---
title: "Hasuraã‚’è©¦ã—ã¦ã¿ãŸ"
emoji: "ğŸ¥"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Hasura", "GraphQL"]
published: false
---
# Hasura CLI ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://hasura.io/docs/latest/graphql/core/hasura-cli/index.html#installation)
```bash
$ npm install -g hasura-cli
```
global ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ãŸã€‚
```bash
$ hasura version
#=> INFO hasura cli is up to date  version=2.0.9
#=> INFO hasura cli                version=v2.0.9
```
ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã—ãŸã€‚

# Local ç’°å¢ƒã§æ§‹ç¯‰
ã¾ãšã¯ hasuraç”¨ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
```bash
$ hasura init hasura-practice
```
[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://hasura.io/docs/latest/graphql/core/getting-started/docker-simple.html#docker-simple)
ã“ã¡ã‚‰ã‚’å‚è€ƒã« docker-compose ã‚’ä½¿ã£ã¦æ§‹ç¯‰ã—ã¦ã„ãã¾ã™ã€‚

å¿µã®ãŸã‚ã€ docker-compose.yml ã«å«ã¾ã‚Œã‚‹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç’°å¢ƒå¤‰æ•°ã«ã—ã¦ãŠãã¾ã™ã€‚
```bash
$ touch .env
```
```env
POSTGRES_PASSWORD=hoge
```
```yml
version: '3.6'
services:
  postgres:
    image: postgres:12
    restart: always
    volumes:
    - db_data:/var/lib/postgresql/data
    environment:
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
  graphql-engine:
    image: hasura/graphql-engine:v2.0.9
    ports:
    - "8080:8080"
    depends_on:
    - "postgres"
    restart: always
    environment:
      ## postgres database to store Hasura metadata
      HASURA_GRAPHQL_METADATA_DATABASE_URL: postgres://postgres:postgrespassword@postgres:5432/postgres
      ## this env var can be used to add the above postgres database to Hasura as a data source. this can be removed/updated based on your needs
      PG_DATABASE_URL: postgres://postgres:postgrespassword@postgres:5432/postgres
      ## enable the console served by server
      HASURA_GRAPHQL_ENABLE_CONSOLE: "true" # set to "false" to disable console
      ## enable debugging mode. It is recommended to disable this in production
      HASURA_GRAPHQL_DEV_MODE: "true"
      HASURA_GRAPHQL_ENABLED_LOG_TYPES: startup, http-log, webhook-log, websocket-log, query-log
      ## uncomment next line to set an admin secret
      # HASURA_GRAPHQL_ADMIN_SECRET: myadminsecretkey
volumes:
  db_data:
```

`docker compose up` ã‚³ãƒãƒ³ãƒ‰ã§è‡ªå‹•çš„ã« `.env` å†…éƒ¨ã®ç’°å¢ƒå¤‰æ•°ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã™ã€‚
è©³ã—ãã¯[ã“ã¡ã‚‰](https://docs.docker.com/compose/environment-variables/)

`docker compose up` ã‚³ãƒãƒ³ãƒ‰ã§Hasura GraphQL Engine ã¨ PostgreSQL ã‚’èµ·å‹•ã—ã¾ã™ã€‚
`locahost:8080`ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

# DBæ¥ç¶š
> Starting from scratch<br>
> 
> If you are looking to start setting up a backend from scratch, we recommend using Postgres as the database.<br>
> 
> If you do not have an existing Postgres database, you can choose to connect to the Postgres database that was created along with Hasura (to store its metadata) and use it as a data source as well. The docker-compose file has an additional env var PG_DATABASE_URL which points to the created metadata database. You can use this env var to connect the same database as a data source and continue.

ä»Šå›ã¯æ—¢å­˜ã®DBã‚’ç”¨æ„ã—ã¦ã„ãªã„ã®ã§ã€ä¸Šè¨˜ã«å¾“ã£ã¦ docker-compose ã§ä½œæˆã•ã‚ŒãŸ DBã‚’ä½¿ã„ã¾ã™ã€‚
docker-compose.yml ã® `PG_DATABASE_URL`ã®å€¤ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®`Database URL` ã«å…¥åŠ›ã—ã¾ã—ã‚‡ã†ã€‚


# ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ä¸Šã‹ã‚‰ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆã™ã‚‹è¨˜äº‹ã¯ã‘ã£ã“ã†è¦‹ã¤ã‹ã‚‹ã®ã§ã™ãŒã€ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã§ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã—ã¦ã„ã‚‹ä¾‹ãŒç„¡ã•ãã†ã ã£ãŸã®ã§è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚
ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯[ã“ã¡ã‚‰](https://hasura.io/docs/latest/graphql/core/databases/postgres/schema/tables.html#create-tables)

```bash
$ hasura migrate create create-user-table --database-name practice
#=> INFO Migrations files created      name=create-user-table version=1632936961196
```
```up.sql
CREATE TABLE users(id serial NOT NULL, name text NOT NULL, email text NOT NULL, PRIMARY KEY (id));
```
```down.sql
DROP TABLE users;
```

```bash
$ hasura migrate apply
```
ã“ã‚Œã‚’å®Ÿè¡Œã™ã‚‹ã¨ users ãƒ†ãƒ¼ãƒ–ãƒ«ãŒä½œæˆã•ã‚Œã‚‹ã€‚
ã—ã‹ã—ã€ã“ã®æ™‚ç‚¹ã§ã¯`Untracked Table`ã¨ã„ã†æ‰±ã„ã«ãªã‚Šã€GraphQLã§ã¯æ‰±ãˆãªã„ã€‚
ãã®ãŸã‚ã€ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ Tracking ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
GUIã§Track ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚ã„ã„ã—ã€ã‚³ãƒ¼ãƒ‰ã§ã‚„ã‚‹ãªã‚‰ä¸‹è¨˜
`metadata/databases/<database name>/tables/tables.yaml`ã®ä¸­èº«ã‚’ä¸‹è¨˜ã«ç½®ãæ›ãˆã€ `hasura metadata apply`
```yaml
- table:
   schema: public
   name: <table name>
```
track ã«ã¤ã„ã¦ã¯[ã“ã¡ã‚‰](https://hasura.io/docs/latest/graphql/core/databases/postgres/schema/using-existing-database.html#step-1-track-tables-views)

ã‚«ãƒ©ãƒ ã®è¿½åŠ 
https://hasura.io/docs/latest/graphql/core/databases/postgres/schema/default-values/created-updated-timestamps.html#add-a-created-at-timestamp